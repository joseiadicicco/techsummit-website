<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speaker Assets Generator - Cardano Tech Summit 2025</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #111827;
            color: #F9FAFB;
        }
        .text-glow {
            text-shadow: 0 0 8px rgba(34, 211, 238, 0.7), 0 0 20px rgba(34, 211, 238, 0.5);
        }
        select, button {
            background-color: #374151;
            border-color: #4b5563;
        }
        .platform-btn.active {
            background-color: #0891b2;
            border-color: #0891b2;
            color: white;
        }
        textarea {
            background-color: #1f2937;
            border-color: #4b5563;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-50">

    <div class="container mx-auto px-4 py-12">
        <header class="text-center mb-12">
             <h1 class="text-4xl md:text-5xl font-black text-white">TechSummit<span class="text-cyan-400">.Lat</span></h1>
            <h2 class="text-2xl mt-2 text-gray-300" data-key="header_title">Speaker Social Media Kit</h2>
            <p class="text-gray-400 mt-2" data-key="header_subtitle">Generate your personalized image and post text for LinkedIn or Twitter.</p>
        </header>

        <main class="max-w-4xl mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 p-6 bg-gray-800 rounded-lg shadow-lg mb-8">
                <!-- Controls -->
                <div>
                    <label for="speaker-select" class="block mb-2 text-sm font-medium text-gray-300" data-key="label_select_name">1. Select your name</label>
                    <select id="speaker-select" class="w-full p-2.5 text-white rounded-lg focus:ring-cyan-500 focus:border-cyan-500">
                        <option selected disabled data-key="option_choose_speaker">Choose a speaker...</option>
                    </select>
                </div>

                <div>
                    <label class="block mb-2 text-sm font-medium text-gray-300" data-key="label_choose_platform">2. Choose platform</label>
                    <div class="flex space-x-2">
                        <button id="platform-linkedin" class="platform-btn flex-1 p-2.5 rounded-lg border-2 border-gray-600 active">LinkedIn</button>
                        <button id="platform-twitter" class="platform-btn flex-1 p-2.5 rounded-lg border-2 border-gray-600">Twitter</button>
                    </div>
                </div>

                <div>
                    <label for="language-select" class="block mb-2 text-sm font-medium text-gray-300" data-key="label_select_language">3. Select language</label>
                    <select id="language-select" class="w-full p-2.5 text-white rounded-lg focus:ring-cyan-500 focus:border-cyan-500">
                        <option value="en">English</option>
                        <option value="es">EspaÃ±ol</option>
                        <option value="pt">PortuguÃªs</option>
                        <option value="ja">æ—¥æœ¬èªž</option>
                    </select>
                </div>
            </div>
            
            <!-- Canvas Preview -->
            <div class="bg-gray-800 p-4 rounded-lg">
                <h3 class="text-lg font-bold mb-4 text-center text-gray-300" data-key="preview_title">Image Preview</h3>
                <canvas id="image-canvas" class="w-full rounded-md shadow-inner"></canvas>
            </div>

            <!-- Download Button -->
            <div class="text-center mt-6">
                <button id="download-btn" class="bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 px-8 rounded-full transition-transform transform hover:scale-105 disabled:bg-gray-500 disabled:cursor-not-allowed" disabled data-key="download_button">
                    Download Image
                </button>
            </div>

            <!-- Post Text Generator -->
            <div class="mt-12">
                <h3 class="text-lg font-bold mb-4 text-center text-gray-300" data-key="post_text_title">Social Media Post Text</h3>
                <div class="relative">
                    <textarea id="post-text" rows="7" class="w-full p-4 rounded-lg text-gray-200" readonly></textarea>
                    <button id="copy-text-btn" class="absolute top-3 right-3 bg-gray-600 hover:bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg disabled:bg-gray-500 disabled:cursor-not-allowed" disabled data-key="copy_button">
                        Copy Text
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- DATA ---
        const speakers = [
            { id: 'guillermo-oliveto', name: 'Guillermo Oliveto', photo: '/images/guillermooliveto.jpg', titleKey: 'speaker_1_title' },
            { id: 'mario-petrucci', name: 'Mario Petrucci', photo: '/images/mariopetrucci.jpg', titleKey: 'speaker_2_title' },
            { id: 'rafael-fraga', name: 'Rafael Fraga', photo: '/images/rafafraga.jpg', titleKey: 'speaker_3_title' },
            { id: 'fede-weill', name: 'Fede Weill', photo: '/images/fedeweill.jpg', titleKey: 'speaker_4_title' },
            { id: 'hugues-dorchy', name: 'Hugues Dorchy', photo: '/images/speakers/hugues.jpg', titleKey: 'speaker_5_title' },
            { id: 'adriano-fiorenza', name: 'Adriano Fiorenza', photo: '/images/adriano.png', titleKey: 'speaker_6_title' },
            { id: 'naielly-marques', name: 'Naielly Marques', photo: '/images/speakers/naielly.JPG', titleKey: 'speaker_7_title' },
            { id: 'claudia-abbas', name: 'Claudia Abbas', photo: '/images/speakers/claudia.jpg', titleKey: 'speaker_8_title' },
            { id: 'rodrigo-chaves', name: 'Rodrigo Chaves', photo: '/images/speakers/rodrigo.png', titleKey: 'speaker_9_title' },
            { id: 'marco-tulio-lima', name: 'Marco Tulio Lima', photo: '/images/speakers/marco.png', titleKey: 'speaker_10_title' },
            { id: 'marcelo-curi', name: 'Marcelo Curi', photo: '/images/speakers/marcelo.jpeg', titleKey: 'speaker_11_title' },
            { id: 'leonardo-gomes', name: 'Leonardo Gomes', photo: '/images/speakers/leonardo.png', titleKey: 'speaker_12_title' },
            { id: 'lucas-macchiavelli', name: 'Lucas Macchiavelli', photo: '/images/speakers/lucas.jpg', titleKey: 'speaker_13_title' },
            { id: 'adriano-manso', name: 'Adriano Manso', photo: '/images/speakers/adrianom.jpeg', titleKey: 'speaker_14_title' },
            { id: 'daniela-alves', name: 'Daniela Alves', photo: '/images/speakers/daniela.jpeg', titleKey: 'speaker_15_title' },
            { id: 'kleber-santos', name: 'Kleber Santos', photo: '/images/speakers/kleber.png', titleKey: 'speaker_16_title' },
            { id: 'jj-siler', name: 'J.J. Siler', photo: '/images/speakers/siler.jpeg', titleKey: 'speaker_17_title' },
            { id: 'sebastian-pabon', name: 'Sebastian Pabon', photo: '/images/speakers/sebastian.jpeg', titleKey: 'speaker_18_title' },
            { id: 'thiago-nunes', name: 'Thiago Nunes', photo: '/images/speakers/thiago.jpeg', titleKey: 'speaker_19_title' },
            { id: 'javier-acosta', name: 'Javier Acosta', photo: '/images/speakers/javier.jpg', titleKey: 'speaker_20_title' },
            { id: 'pamela-johnson', name: 'Pamela Johnson', photo: '/images/speakers/pamela.jpeg', titleKey: 'speaker_21_title' },
            { id: 'erick-romero', name: 'Erick Romero', photo: '/images/speakers/erick.jpg', titleKey: 'speaker_22_title' },
            { id: 'ulises-barreiro', name: 'Ulises Barreiro', photo: '/images/speakers/ulises.jpg', titleKey: 'speaker_23_title' },
            { id: 'rodrigo-oyarzun', name: 'Rodrigo Oyarzun', photo: '/images/speakers/rodrigo.jpg', titleKey: 'speaker_24_title' },
            { id: 'sebastian-videmato', name: 'Sebastian Videmato', photo: '/images/speakers/sebastianvidemato.jpeg', titleKey: 'speaker_25_title' },
            { id: 'sebastian-aravena', name: 'Sebastian Aravena', photo: '/images/speakers/sebaaravena.jpeg', titleKey: 'speaker_26_title' },
            { id: 'lucimar-cunha', name: 'Lucimar Cunha', photo: '/images/speakers/lucimar.jpeg', titleKey: 'speaker_27_title' },
            { id: 'marcus-vinicius', name: 'Marcus Vinicius', photo: '/images/speakers/marcus.jpeg', titleKey: 'speaker_28_title' },
            { id: 'otavio-lima', name: 'Otavio Lima', photo: '/images/speakers/otavio.jpg', titleKey: 'speaker_29_title' },
            { id: 'fabio-moraes', name: 'FÃ¡bio Moraes', photo: '/images/speakers/fabio.jpeg', titleKey: 'speaker_30_title' }
        ];

        const translations = {
            en: {
                header_title: "Speaker Social Media Kit",
                header_subtitle: "Generate your personalized image and post text for LinkedIn or Twitter.",
                label_select_name: "1. Select your name",
                option_choose_speaker: "Choose a speaker...",
                label_choose_platform: "2. Choose platform",
                label_select_language: "3. Select language",
                preview_title: "Image Preview",
                download_button: "Download Image",
                post_text_title: "Social Media Post Text",
                copy_button: "Copy Text",
                copied_confirmation: "Copied!",
                post_text: "âœ¨ We are pleased to announce [@SpeakerName] as a speaker at the Cardano Tech Summit 2025 in Rio de Janeiro! ðŸš€\n\nðŸ“… October 15, 9 AM.\nðŸ“ Museum of Tomorrow\n\nAn unmissable event of innovation, technology, and future.",
                speaker_at: 'SPEAKER AT',
                speaker_1_title: 'Dean of UTN FRBA',
                speaker_2_title: 'President of the Argentine Chess Federation',
                speaker_3_title: 'LATAM Business Development Lead at Cardano Foundation',
                speaker_4_title: 'Co-founder of Txpipe.io',
                speaker_5_title: 'Founder of Sead',
                speaker_6_title: 'Founder of GameChanger Wallet',
                speaker_7_title: 'Assistant Professor, PUC-Rio',
                speaker_8_title: 'Professor, University of BrasÃ­lia',
                speaker_9_title: 'Air Emissions Inventory Coordinator, Petrobras',
                speaker_10_title: 'Product Manager, SERPRO',
                speaker_11_title: 'Blockchain & WEB3 Certified Architect, Petrobras',
                speaker_12_title: 'Professor, PUC Rio',
                speaker_13_title: 'Cardano Ambassador & DRep',
                speaker_14_title: 'Legal Manager, Petrobras',
                speaker_15_title: 'Co-founder, GovChainLab',
                speaker_16_title: 'Assessor da PresidÃªncia, Serpro',
                speaker_17_title: 'VP of Commercial, Input Output',
                speaker_18_title: 'Co-founder, Andamio',
                speaker_19_title: 'Founder, TapDano',
                speaker_20_title: 'Founder, Exura Labs',
                speaker_21_title: 'Co-Founder, Exura Labs',
                speaker_22_title: 'CTO Edda Labs',
                speaker_23_title: 'CEO, Token Mithrandir',
                speaker_24_title: 'Cardano Ambassador',
                speaker_25_title: 'Cardano Ambassador',
                speaker_26_title: 'Community Manager, Cardano Foundation',
                speaker_27_title: 'SubsecretÃ¡ria de InovaÃ§Ã£o, NiterÃ³i',
                speaker_28_title: 'Cardano Community Builder & Consultant',
                speaker_29_title: 'Cardano Ambassador. Founder & CEO at CardanoFeed.com',
                speaker_30_title: 'Director of Education and Research at Abcripto'
            },
            es: {
                header_title: "Kit de Redes Sociales para Ponentes",
                header_subtitle: "Genera tu imagen y texto personalizados para LinkedIn o Twitter.",
                label_select_name: "1. Selecciona tu nombre",
                option_choose_speaker: "Elige un ponente...",
                label_choose_platform: "2. Elige la plataforma",
                label_select_language: "3. Selecciona el idioma",
                preview_title: "Vista Previa de la Imagen",
                download_button: "Descargar Imagen",
                post_text_title: "Texto para PublicaciÃ³n",
                copy_button: "Copiar Texto",
                copied_confirmation: "Â¡Copiado!",
                post_text: "âœ¨ Â¡Tenemos el agrado de anunciar a [@SpeakerName] como speaker del Cardano Tech Summit 2025 en RÃ­o de Janeiro! ðŸš€\n\nðŸ“… 15 de octubre, 9Hs.\nðŸ“ Museo del MaÃ±ana\n\nUn encuentro imperdible de innovaciÃ³n, tecnologÃ­a y futuro.",
                speaker_at: 'PONENTE EN',
                speaker_1_title: 'Decano de la UTN FRBA',
                speaker_2_title: 'Presidente FederaciÃ³n Argentina de Ajedrez',
                speaker_30_title: 'Director de EducaciÃ³n e InvestigaciÃ³n en Abcripto'
            },
            pt: {
                header_title: "Kit de MÃ­dia Social para Palestrantes",
                header_subtitle: "Gere sua imagem e texto personalizados para LinkedIn ou Twitter.",
                label_select_name: "1. Selecione seu nome",
                option_choose_speaker: "Escolha um palestrante...",
                label_choose_platform: "2. Escolha a plataforma",
                label_select_language: "3. Selecione o idioma",
                preview_title: "PrÃ©-visualizaÃ§Ã£o da Imagem",
                download_button: "Baixar Imagem",
                post_text_title: "Texto para PublicaÃ§Ã£o",
                copy_button: "Copiar Texto",
                copied_confirmation: "Copiado!",
                post_text: "âœ¨ Temos o prazer de anunciar [@SpeakerName] como palestrante no Cardano Tech Summit 2025 no Rio de Janeiro! ðŸš€\n\nðŸ“… 15 de outubro, 9h.\nðŸ“ Museu do AmanhÃ£\n\nUm encontro imperdÃ­vel de inovaÃ§Ã£o, tecnologia e futuro.",
                speaker_at: 'PALESTRANTE EM',
                speaker_1_title: 'Reitor da UTN FRBA',
                speaker_2_title: 'Presidente da FederaÃ§Ã£o Argentina de Xadrez',
                speaker_30_title: 'Diretor de EducaÃ§Ã£o e Pesquisa na Abcripto'
            },
            ja: {
                header_title: "ç™»å£‡è€…å‘ã‘ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢ã‚­ãƒƒãƒˆ",
                header_subtitle: "LinkedInã¾ãŸã¯Twitterç”¨ã®å€‹äººç”¨ç”»åƒã¨æŠ•ç¨¿ãƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚",
                label_select_name: "1. ã‚ãªãŸã®åå‰ã‚’é¸æŠžã—ã¦ãã ã•ã„",
                option_choose_speaker: "ç™»å£‡è€…ã‚’é¸æŠž...",
                label_choose_platform: "2. ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚’é¸æŠž",
                label_select_language: "3. è¨€èªžã‚’é¸æŠž",
                preview_title: "ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼",
                download_button: "ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
                post_text_title: "ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢æŠ•ç¨¿ãƒ†ã‚­ã‚¹ãƒˆ",
                copy_button: "ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼",
                copied_confirmation: "ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼",
                post_text: "âœ¨ ãƒªã‚ªãƒ‡ã‚¸ãƒ£ãƒã‚¤ãƒ­ã§é–‹å‚¬ã•ã‚Œã‚‹Cardano Tech Summit 2025ã«[@SpeakerName]æ°ãŒç™»å£‡è€…ã¨ã—ã¦å‚åŠ ã•ã‚Œã‚‹ã“ã¨ã‚’ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ï¼ðŸš€\n\nðŸ“… 10æœˆ15æ—¥ã€åˆå‰9æ™‚\nðŸ“ æ˜Žæ—¥ã®åšç‰©é¤¨\n\né©æ–°ã€æŠ€è¡“ã€ãã—ã¦æœªæ¥ã«ã¤ã„ã¦ã®è¦‹é€ƒã›ãªã„ã‚¤ãƒ™ãƒ³ãƒˆã§ã™ã€‚",
                speaker_at: 'ç™»å£‡è€…',
                speaker_1_title: 'UTN FRBAå­¦éƒ¨é•·',
                speaker_2_title: 'ã‚¢ãƒ«ã‚¼ãƒ³ãƒãƒ³ãƒã‚§ã‚¹é€£ç›Ÿä¼šé•·',
                speaker_30_title: 'Abcripto æ•™è‚²ç ”ç©¶ãƒ‡ã‚£ãƒ¬ã‚¯ã‚¿ãƒ¼'
            }
        };
        // Add all other speaker titles to the translation objects for brevity
        Object.keys(translations).forEach(lang => {
            for (let i = 3; i <= 29; i++) {
                if (!translations[lang][`speaker_${i}_title`]) {
                    translations[lang][`speaker_${i}_title`] = translations['en'][`speaker_${i}_title`];
                }
            }
        });

        // --- DOM ELEMENTS ---
        const speakerSelect = document.getElementById('speaker-select');
        const languageSelect = document.getElementById('language-select');
        const linkedinBtn = document.getElementById('platform-linkedin');
        const twitterBtn = document.getElementById('platform-twitter');
        const canvas = document.getElementById('image-canvas');
        const downloadBtn = document.getElementById('download-btn');
        const postTextarea = document.getElementById('post-text');
        const copyTextBtn = document.getElementById('copy-text-btn');
        const ctx = canvas.getContext('2d');

        // --- STATE ---
        let selectedState = {
            speakerId: null,
            platform: 'linkedin',
            language: 'en'
        };
        
        // --- FUNCTIONS ---
        
        function populateSpeakers() {
            speakers.sort((a, b) => a.name.localeCompare(b.name));
            speakers.forEach(speaker => {
                const option = document.createElement('option');
                option.value = speaker.id;
                option.textContent = speaker.name;
                speakerSelect.appendChild(option);
            });
        }
        
        function updateStaticText() {
            const lang = selectedState.language;
            document.querySelectorAll('[data-key]').forEach(element => {
                const key = element.dataset.key;
                if(translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
        }

        function loadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = "Anonymous";
                img.src = src;
                img.onload = () => resolve(img);
                img.onerror = () => reject(new Error(`Failed to load image: ${src}`));
            });
        }

        async function generateImage() {
            if (!selectedState.speakerId) return;
            const speaker = speakers.find(s => s.id === selectedState.speakerId);
            if (!speaker) return;

            const platform = selectedState.platform;
            const lang = selectedState.language;

            const width = platform === 'linkedin' ? 1080 : 1200;
            const height = platform === 'linkedin' ? 1080 : 628;
            canvas.width = width;
            canvas.height = height;

            try {
                const backgroundSrc = platform === 'linkedin' ? '/images/linkedinback.png' : '/images/twitterback.png';
                const [speakerImg, backgroundImg] = await Promise.all([
                    loadImage(speaker.photo),
                    loadImage(backgroundSrc)
                ]);

                // Draw background
                ctx.drawImage(backgroundImg, 0, 0, width, height);

                // Speaker Image (circular)
                const imgSize = height * 0.5;
                const imgX = (width / 2) - (imgSize / 2);
                const imgY = height * 0.15;
                ctx.save();
                ctx.beginPath();
                ctx.arc(imgX + imgSize / 2, imgY + imgSize / 2, imgSize / 2, 0, Math.PI * 2, true);
                ctx.closePath();
                ctx.clip();
                ctx.drawImage(speakerImg, imgX, imgY, imgSize, imgSize);
                ctx.restore();
                
                // Text rendering
                ctx.textAlign = 'center';
                ctx.fillStyle = '#FFFFFF';
                ctx.font = `bold ${height * 0.08}px 'Poppins', sans-serif`;
                ctx.fillText(speaker.name, width / 2, height * 0.75);
                
                const titleText = translations[lang][speaker.titleKey] || translations['en'][speaker.titleKey];
                ctx.fillStyle = '#67e8f9';
                ctx.font = `600 ${height * 0.035}px 'Poppins', sans-serif`;
                wrapText(titleText, width / 2, height * 0.82, width * 0.8, height * 0.04);

                // Define texts
                const speakerAtText = translations[lang].speaker_at || translations['en'].speaker_at;
                const logoMainText = "TechSummit";
                const logoSubText = ".Lat";
                const spacing = width * 0.02;

                // --- Calculate total width ---
                // Measure "SPEAKER AT"
                ctx.font = `bold ${height * 0.025}px 'Poppins', sans-serif`;
                ctx.letterSpacing = '0px';
                const speakerAtTextWidth = ctx.measureText(speakerAtText).width;

                // Measure Logo
                const logoFontSize = height * 0.035; // Increased size
                ctx.font = `900 ${logoFontSize}px 'Poppins', sans-serif`;
                
                // Measure ".Lat" first
                ctx.letterSpacing = '0px'; // Ensure no spacing for this part
                const logoSubWidth = ctx.measureText(logoSubText).width;

                // Now measure "TechSummit" with spacing
                ctx.letterSpacing = '2px'; // Add spacing
                const logoMainWidth = ctx.measureText(logoMainText).width;

                const totalLogoWidth = logoMainWidth + logoSubWidth;
                const totalBlockWidth = speakerAtTextWidth + spacing + totalLogoWidth;

                // --- Start drawing ---
                let currentX = (width / 2) - (totalBlockWidth / 2);
                const yPos = height * 0.10;

                // Set vertical alignment for consistency
                ctx.textBaseline = 'middle';

                // 1. Draw "SPEAKER AT"
                ctx.font = `bold ${height * 0.025}px 'Poppins', sans-serif`;
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.textAlign = 'left';
                ctx.letterSpacing = '0px'; // Reset for this text
                ctx.fillText(speakerAtText, currentX, yPos);
                currentX += speakerAtTextWidth + spacing;

                // 2. Draw Logo
                ctx.font = `900 ${logoFontSize}px 'Poppins', sans-serif`;
                ctx.fillStyle = '#FFFFFF';
                ctx.letterSpacing = '2px'; // Apply spacing for TechSummit
                ctx.fillText(logoMainText, currentX, yPos);
                currentX += logoMainWidth;

                ctx.fillStyle = '#22d3ee';
                ctx.letterSpacing = '0px'; // Reset for .Lat
                ctx.fillText(logoSubText, currentX, yPos);

                // Reset text properties for subsequent drawing
                ctx.textAlign = 'center';
                ctx.textBaseline = 'alphabetic'; // Default baseline
                ctx.letterSpacing = '0px';
                
            } catch (error) {
                console.error("Error generating image:", error);
                ctx.fillStyle = '#111827';
                ctx.fillRect(0, 0, width, height);
                ctx.fillStyle = '#FF0000';
                ctx.font = "24px Arial";
                ctx.textAlign = 'center';
                ctx.fillText("Error loading images. Check console.", width/2, height/2);
            }
        }
        
        function wrapText(text, x, y, maxWidth, lineHeight) {
            const words = text.split(' ');
            let line = '';
            let lineArray = [];

            for(let n = 0; n < words.length; n++) {
                let testLine = line + words[n] + ' ';
                let metrics = ctx.measureText(testLine);
                if (metrics.width > maxWidth && n > 0) {
                    lineArray.push(line);
                    line = words[n] + ' ';
                } else {
                    line = testLine;
                }
            }
            lineArray.push(line);
            
            let startY = y - (lineHeight * (lineArray.length - 1)) / 2;

            for(let i = 0; i < lineArray.length; i++) {
                ctx.fillText(lineArray[i].trim(), x, startY + (i * lineHeight));
            }
        }

        function generateText() {
            if (!selectedState.speakerId) {
                postTextarea.value = '';
                return;
            };
            const speaker = speakers.find(s => s.id === selectedState.speakerId);
            const lang = selectedState.language;
            const template = translations[lang].post_text || translations['en'].post_text;
            postTextarea.value = template.replace('[@SpeakerName]', speaker.name);
        }

        function updateAssets() {
            const speakerId = speakerSelect.value;
            selectedState.language = languageSelect.value;
            
            updateStaticText();
            
            if (speakerId && speakerId !== 'Choose a speaker...') {
                selectedState.speakerId = speakerId;
                downloadBtn.disabled = false;
                copyTextBtn.disabled = false;
                generateImage();
                generateText();
            } else {
                selectedState.speakerId = null;
                downloadBtn.disabled = true;
                copyTextBtn.disabled = true;
                // Clear canvas and text area if no speaker is selected
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                postTextarea.value = '';
            }
        }

        // --- EVENT LISTENERS ---
        speakerSelect.addEventListener('change', updateAssets);
        languageSelect.addEventListener('change', updateAssets);

        linkedinBtn.addEventListener('click', () => {
            selectedState.platform = 'linkedin';
            linkedinBtn.classList.add('active');
            twitterBtn.classList.remove('active');
            updateAssets();
        });

        twitterBtn.addEventListener('click', () => {
            selectedState.platform = 'twitter';
            twitterBtn.classList.add('active');
            linkedinBtn.classList.remove('active');
            updateAssets();
        });
        
        downloadBtn.addEventListener('click', () => {
            const speaker = speakers.find(s => s.id === selectedState.speakerId);
            const link = document.createElement('a');
            link.download = `TechSummit_Speaker_${speaker.name.replace(/\s/g, '_')}_${selectedState.platform}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        });

        copyTextBtn.addEventListener('click', () => {
            postTextarea.select();
            document.execCommand('copy'); // Using execCommand for broader compatibility in iFrames
            const originalText = copyTextBtn.textContent;
            const lang = selectedState.language;
            copyTextBtn.textContent = translations[lang].copied_confirmation || 'Copied!';
            setTimeout(() => {
                copyTextBtn.textContent = originalText;
                updateStaticText(); // Restore original button text in correct language
            }, 2000);
        });

        // --- INITIALIZATION ---
        populateSpeakers();
        updateStaticText();
    });
    </script>
</body>
</html>

